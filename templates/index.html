<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chest Cancer Classification</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #0a192f; /* Deep Navy */
      }
      .shiny-text {
        color: #f8fafc;
        text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
      }
      .glass-card {
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      .loader {
        border: 4px solid #1e293b;
        border-top: 4px solid #38bdf8;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Custom Scrollbar */
      ::-webkit-scrollbar {
        width: 6px;
      }
      ::-webkit-scrollbar-track {
        background: #0a192f;
      }
      ::-webkit-scrollbar-thumb {
        background: #1e293b;
        border-radius: 10px;
      }
    </style>
  </head>
  <body class="text-slate-200 min-h-screen flex flex-col">
    <header class="py-8 text-center">
      <h1 class="text-4xl font-bold shiny-text tracking-tight">
        Chest Cancer <span class="text-blue-400">Classification</span>
      </h1>
      <p class="text-slate-400 mt-2 text-sm uppercase tracking-widest">
        Medical Imaging Intelligence
      </p>
    </header>

    <main class="container mx-auto px-4 flex-grow">
      <div class="grid lg:grid-cols-2 gap-8 max-w-6xl mx-auto">
        <div class="glass-card p-6 rounded-2xl shadow-2xl">
          <div
            class="relative group overflow-hidden rounded-xl border-2 border-dashed border-slate-700 hover:border-blue-500 transition-colors bg-slate-900/50 aspect-square max-w-[400px] mx-auto"
          >
            <video
              autoplay
              id="video"
              class="w-full h-full object-cover"
              poster="https://img.freepik.com/free-vector/group-young-people-posing-photo_52683-18824.jpg?size=338&ext=jpg"
            ></video>
            <img src="" id="photo" class="hidden w-full h-full object-cover" />
            <canvas id="canvas" class="hidden"></canvas>
          </div>

          <div class="mt-8 flex flex-col sm:flex-row gap-4 justify-center">
            <button
              id="uload"
              class="flex-1 bg-slate-800 hover:bg-slate-700 text-white font-semibold py-3 px-6 rounded-xl transition-all border border-slate-600 active:scale-95"
            >
              Choose Image
            </button>
            <button
              id="send"
              class="flex-1 bg-blue-600 hover:bg-blue-500 text-white font-semibold py-3 px-6 rounded-xl shadow-lg shadow-blue-900/20 transition-all active:scale-95"
            >
              Run Prediction
            </button>
          </div>

          <input type="file" id="fileinput" class="hidden" />
          <input type="hidden" id="url" value="../predict" />
        </div>

        <div
          class="glass-card p-6 rounded-2xl flex flex-col h-full border border-blue-500/20"
        >
          <h2 class="text-xl font-semibold mb-6 flex items-center gap-2">
            <span class="w-2 h-2 bg-blue-400 rounded-full animate-pulse"></span>
            Analysis Results
          </h2>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 flex-grow">
            <div
              id="res-part2"
              class="bg-slate-900/80 rounded-xl border border-slate-800 flex items-center justify-center overflow-hidden min-h-[250px]"
            >
              <span class="text-slate-600 italic text-sm"
                >Processed view will appear here</span
              >
            </div>

            <div
              id="res-part"
              class="bg-slate-950 rounded-xl border border-slate-800 p-4 overflow-auto max-h-[400px] text-xs font-mono text-blue-300"
            >
              <span class="text-slate-600">Waiting for data...</span>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer
      class="p-8 flex justify-center opacity-50 hover:opacity-100 transition-opacity"
    >
      <img
        class="h-8 brightness-0 invert"
        src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIkAAAAlCAMAAABBJDpuAAAAVFBMVEX/fgD/iQA7NzIyMjMnNYInNYEnNYInNYEzMzInNYQnNYETJzsnNYIwN1wxMjNoTis4O1YrNm0xOF47PE9DP0dEQEVpTVkAJJ4nNYEOLJHJbiAzMzOmmmHRAAAAFnRSTlOh/vu+986oen9fP2UqEzQkFAIDAAEEILVBJQAAA3FJREFUWMPNmO2WoyAMQG0VBARtdVRs3/89NwkgaF1rd2aOm18tIrnkgwSz7n+R7LcV1ELkeS7E7VySRlyfQXJhTiO55c+liP4cEuH1X8E7gaV+S3Jv2zYZ/Vr+/Sdx2vP6doc/fSPcf/GOpLSFVXFUW8t+giRP47TOd60yk1hbxIhSP0ACKPWrvw7YBIT/lcQY84G3Wk17ugWQfg5UsQJpjflKSLQi7xTWyk0SXTJ4VnB5D1yccxmp4Z+mX5KGNS+SPXVNll0ulyxL0wYmloBB6zL/MpCoAgjAFiUM6w0SboMwPUdRogvNKcNM3smFdRvEcJJkKcflAa+X0pNIfBGW0zKqjyQtw4VLKQlI7ZLgdrRNSZDjMQx2GB4pCkxkCrfGWUTJ0Egan6muCHgJCUwtnCk0mrJ9Q8K5LUqtdSfynkAedhynaRqngVDaXLiJEAzkFkM71IuIlWRYtSQpbXSZDvQ7JPCei9brs+oaABkn74LRIkpFaVxGnzjvIxTYREOoEwn5r01JTDRTcO87Eu3zNUeTPKZpjrIRrNIDCjzALbPk7LJMIokOEQu2K7yKQAKvFDF9pVe0R+LGb7h1MMkw2ijjA/1zhSfSphvEAChXJEhAqwYStIJWXnTpvbdH4hTUwSQ2JRmQpILDLYbB7J41SYiLcNozu5Z3JMo7RxBJahI7WSRByCMkqJt9hySESbVJcvmARJGFExJmdBSl2oM2+T4JLWfgaGFptizlPUm1FydHSdyZ7UnS4ySph2kS0kJrkvr5NJg7dnrJnfxgxPozRPGtkyPNOxtaiDvbIAF9L+5B5zTI2BwlwXmM+U3zReav3o0F8oUEFFZ42McDZYomOUziFmezgWyo251Uc1nyKJol7URCEvIYUEbHYaEGQi9C9egwCdVfHwiaajfjKMUcHcRacCylhWJbJDfq47EEDhYqoIWjHnwDXZPpPiChPQelLU+Cbm4w50FmYgkvFwpiWwCC/Um/SLcNElOC9RVj6qWpCiEMvRUK4zLpdKmPw8rVldy/qxjn60wLrVLWJIPLiZJRr3fsvnOHPvare+lB93tb37T20D82jqOt+zNuXhuNvNhp7X+PpHb3rvV9R5xjE2SpyCN9ffQO+GtWIZr5Xnytz4gTMIRYfys47/uJEXny/aQ/95tSUwmU+uRvSp/IHzQqZYpYrQmxAAAAAElFTkSuQmCC"
      />
    </footer>

    <div
      id="loading"
      class="fixed inset-0 bg-slate-950/80 backdrop-blur-sm z-50 hidden flex items-center justify-center"
    >
      <div class="text-center">
        <div class="loader mx-auto mb-4"></div>
        <p class="text-blue-400 font-medium animate-pulse">
          Analyzing Image...
        </p>
      </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script>
      var myvideo = document.getElementById("video");
      var myphoto = document.getElementById("photo");
      var base_data = "";

      function sendRequest(base64Data) {
        if (base64Data != "" && base64Data != null) {
          var url = $("#url").val();
          $("#loading").removeClass("hidden");
          $.ajax({
            url: url,
            type: "post",
            cache: false,
            async: true,
            crossDomain: true,
            headers: {
              "Content-Type": "application/json",
              "Access-Control-Allow-Origin": "*",
            },
            data: JSON.stringify({ image: base64Data }),
            success: function (res) {
              $("#res-part").html("");
              $("#res-part2").html("");
              try {
                var imageData = res[1].image;
                if (imageData.length > 100) {
                  $("#res-part2").html(
                    "<img class='w-full h-full object-contain' src='data:image/jpeg;base64," +
                      imageData +
                      "' />",
                  );
                }
              } catch (e) {
                $("#res-part2").html(
                  "<span class='text-slate-600 text-xs'>No visualization returned</span>",
                );
              }
              $("#res-part").html(
                "<pre class='whitespace-pre-wrap'>" +
                  JSON.stringify(res[0], undefined, 2) +
                  "</pre>",
              );
              $("#loading").addClass("hidden");
            },
            error: function () {
              $("#loading").addClass("hidden");
              alert("Prediction failed. Please check the API connection.");
            },
          });
        } else {
          alert("Please upload an image first.");
        }
      }

      $(document).ready(function () {
        $("#send").click(function () {
          sendRequest(base_data);
        });
        $("#uload").click(function () {
          $("#fileinput").trigger("click");
        });

        $("#fileinput").change(function () {
          if (this.files && this.files[0]) {
            var reader = new FileReader();
            reader.onload = function (e) {
              var url = e.target.result;
              var img = new Image();
              img.crossOrigin = "Anonymous";
              img.onload = function () {
                var canvas = document.createElement("CANVAS");
                var ctx = canvas.getContext("2d");
                canvas.height = this.height;
                canvas.width = this.width;
                ctx.drawImage(this, 0, 0);
                base_data = canvas
                  .toDataURL("image/jpeg", 1.0)
                  .replace(/^data:image.+;base64,/, "");
              };
              img.src = url;
              $("#photo").attr("src", url).removeClass("hidden");
              $("#video").addClass("hidden");
            };
            reader.readAsDataURL(this.files[0]);
          }
        });
      });
    </script>
  </body>
</html>
